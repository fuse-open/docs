{
  "entity": {
    "id": {
      "id": "fuse/pushnotifications",
      "parentId": "fuse",
      "type": "Namespace",
      "modifiers": []
    },
    "uri": {
      "idUri": "fuse/pushnotifications",
      "href": "fuse/pushnotifications"
    },
    "titles": {
      "pageTitle": "Fuse.PushNotifications Namespace",
      "navigationTitle": "Fuse.PushNotifications Namespace",
      "fullTitle": "Fuse.PushNotifications",
      "indexTitle": "Fuse.PushNotifications",
      "fullyQualifiedIndexTitle": "Fuse.PushNotifications"
    },
    "syntax": {
      "uno": "namespace PushNotifications {}"
    }
  },
  "tableOfContents": {
    "jsModules": [
      {
        "items": [
          {
            "comment": {
              "brief": "Handles push notification from messaging services.",
              "full": "Handles push notification from messaging services.\n\nThis module currently supports APNS (Apple Push Notification Service) and GCM (Google Cloud Messaging).\n\nFuse provides support for push-notifications from Firebase Cloud Messaging (FCM) and Apple' Push Notification Service (APNS).\n\nWe have opted for a lightweight consistent interface across iOS and Android which we can easily expand as needed.\n\n> We are very interested in comments & requests you have on what we have so far so do drop by the forums and let us know.\n\n## Setting up the client side\n\n### Step 1.\n\nInclude the Fuse push notification library by adding the following to your `.unoproj` file\n```json\n    \"Packages\": [\n        ...\n        \"Fuse.PushNotifications\",\n        ...\n    ],\n```\n### Step 2. (Only for Android)\n\nGoogle notifications require a little extra info.\n\nAdd the following to you `.unoproj`\n```json\n    \"Android\": {\n        ...\n        \"GooglePlay\": {\n            \"SenderID\": \"111781901112\"\n        }\n        ...\n    },\n```\nThe `SenderID` is the sender ID from the [Firebase Console](https://console.firebase.google.com).\nIf you don't yet have a project set up please see the [Android setup](#android-setup) section later in this document.\n\n## How this behaves in your app\n\nReferencing `Fuse.PushNotifications` will do the the following:\n\n### Both Platforms\n\n- You get a callback telling you if the registration succeeded or failed.\n- The succeeded callback will contain your unique registration id (also called a token in iOS docs)\n- All future received push notifications will fire a callback containing the JSON of the notification.\n\nAll three callbacks mentioned are available in JavaScript and Uno.\n\n### Android specific\n\n- Your SenderID is added to the project's `Manifest.xml` file along with some other plumbing\n- When your app starts the app registers with the `GCM` service.\n\n### iOS specific\n\n- When your app starts it registers with APNS. As all access is controlled through Apple's certificate system there is no extra info to provide (we will mention server side a bit later)\n\nIf you wish to disable auto-registration you can place the following in your unoproj file:\n```json\n    \"iOS\": {\n        \"PushNotifications\": {\n            \"RegisterOnLaunch\": false\n        }\n    },\n    \"Android\": {\n        \"PushNotifications\": {\n            \"RegisterOnLaunch\": false\n        }\n    },\n```\nYou must then register for push notifications by calling `register()` from JS. This option is useful as when the notifications are registered the OS may ask the user for permission to use push notifications and this may be undesirable on launch.\n\n## Using the API from JavaScript\n\nIntegrating with notifications from JavaScript is simple. Here is an example that just logs when the callbacks fire:\n```xml\n    <JavaScript>\n        var push = require(\"FuseJS/Push\");\n\n        push.on(\"registrationSucceeded\", function(regID) {\n            console.log(\"Reg Succeeded: \" + regID);\n        });\n\n        push.on(\"error\", function(reason) {\n            console.log(\"Reg Failed: \" + reason);\n        });\n\n        push.on(\"receivedMessage\", function(payload) {\n            console.log(\"Recieved Push Notification: \" + payload);\n        });\n    </JavaScript>\n```\nHere we're using the @EventEmitter `on` method to register our functions with the different events.\nIn a real app we should send our `registration ID` to our server when `registrationSucceeded` is triggered.\n\n## Server Side\n\nWhen we have our client all set up and ready to go we move on to the backend. For this we are required to jump through the hoops provided by Apple and Google.\n\nSee below for the following guides on how to do this for specific platforms:\n\n- [iOS Setup](#ios-setup)\n- [Android Setup](#android-setup)\n\n## The Notification\n\nWe support push notifications in JSON format. When a notification arrives one of two things will happen:\n\n- If our app has focus, the callback is called right away with the full JSON payload\n- If our app doesn't have focus, (and our JSON contains the correct data) we will add a system notification to the notification bar (called the Notification Center in iOS). When the user clicks the notification in the drop down then our app is launched and the notification is delivered.\n\nApple and Google's APIs define how the data in the payload is used to populate the system notification, however we have normalized it a little.\n\nFor iOS we'll just include an `aps` entry in the notification's JSON, like so:\n```json\n    'aps': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server'\n        }\n    },\n```\nAnd 'title' and 'body' will be used as the title and body of the system notification.\n\nFor Android we can use exactly the same `'aps'` entry or the alternatively the following:\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server'\n        }\n    },\n```\nThe `notification` entry is the standard Google way of doing this but we felt that it wouldn't hurt to support the Apple way too.\n\n> The current implementation only guarantees the `title` and `body` entries will work. We also always use your app's icon as the notification icon. This is an area we will extend as Fuse matures. If you have specific requests, be sure to let us know!\n\n## Message size limits\n\nGoogle and Apple has different limits on the size of push notifications.\n\n- Google limits to 4096 bytes\n- Apple limits to 2048 bytes on iOS 8 and up but only 256 bytes on all earlier versions\n\n## Additional Android Push Notification Features\n\nSince Android 8+ (Oreo or API 26), it is mandatory to define and assign a channel to every notification.\n\nWe have defined a default channel (named \"App\") to be assigned to notifications if they aren't already assigned a channel, so you don't need to define one but if you do want to customise it, read on.\n\nNB! Once a channel is created, you CANNOT change its properties later.\n\nApart from the Notification Channel feature discussed above, here is a list of the other android features implemented thus far:\n\n- Notification Sound\n- Notification Color\n- Notification Priority\n- Notification Category\n- Notification Lockscreen Visibility\n\nAndroid 8+\n- Notification Channel\n- Nofitication Channel Group\n- Notification Channel Importance\n- Notification Channel Lockscreen Visibility\n- Notification Channel Light Color\n- Notification Channel Sound\n- Notification Channel Vibration\n- Notification Channel Show Badge\n- Notification Badge Number\n- Notification Badge Icon Type\n\nWe'll show you how to implement them here in fuse but read more about each feature [here](https://developer.android.com/guide/topics/ui/notifiers/notifications).\n\n#### Notification Sound - Value - default\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'sound': 'default'\n        }\n    },\n```\n\n#### Notification Color - Values - #RRGGBB | #AARRGGBB\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'color': '#8811FF'\n        }\n    },\n```\n\n#### Notification Priority - Values - high | low | max | min\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationPriority': 'high'\n        }\n    },\n```\n\n#### Notification Category - Values - alarm | reminder | event | call | message | email | promo | recommendation | social | error | progress | service | status | system | transport\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationCategory': 'social'\n        }\n    },\n```\n\n#### Notification Lockscreen Visibility - Values - public | secret | private\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationLockscreenVisibility': 'secret'\n        }\n    },\n```\n\n#### Notification Channel\n\nNotification Channel and a Notification Channel Group:\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelGroupId': 'sports',\n            'notificationChannelGroupName': 'Sports',\n            'notificationChannelId': 'sports_football_highlights',\n            'notificationChannelName': 'Football Highlights',\n            'notificationChannelDescription': 'Video commentary once a week'\n        }\n    },\n```\nNotification Channel Importance - Values - urgent | high | medium | low | none\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelGroupId': 'sports',\n            'notificationChannelGroupName': 'Sports',\n            'notificationChannelId': 'sports_basketball_highlights',\n            'notificationChannelName': 'Basketball Highlights',\n            'notificationChannelDescription': 'Video commentary once a week',\n            'notificationChannelImportance': 'urgent',\n\n        }\n    },\n```\n\nNotification Channel Lockscreen Visibility - Values - public | secret | private\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelLockscreenVisibility': 'private'\n        }\n    },\n```\n\nNotification Channel Light Color - Values - #RRGGBB\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelLightColor': '#1188FF'\n        }\n    },\n```\n\nNotification Channel Sound - Values - true | false\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelIsSoundOn': 'true'\n        }\n    },\n```\n\nNotification Channel Vibration - Values - true | false\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelIsVibrationOn': 'true'\n        }\n    },\n```\n\nNotification Channel Show Badge - Values - true | false\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationChannelIsShowBadgeOn': 'true'\n        }\n    },\n```\n\n#### Notification Badge\n\nNotification Channel Badge Number\n```json\n   'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationBadgeNumber': '23'\n        }\n    },\n```\n\nNotification Channel Badge Icon Type - Values - none | small | large\n```json\n    'notification': {\n        alert: {\n            'title': 'Well would ya look at that!',\n            'body': 'Hello from the server',\n            'notificationBadgeIconType': 'small'\n        }\n    },\n```\n\n#### Notification Uno Project Configurations\n\nThe following notification settings can be set via the `.unoproj` settings:\n```json\n    \"Android\": {\n        ...\n        \"Notification\": {\n            \"DefaultChannelGroupId\": \"default_group\",\n            \"DefaultChannelGroupName\": \"Categories\",\n            \"DefaultChannelId\": \"default_channel\",\n            \"DefaultChannelName\": \"App\",\n            \"DefaultChannelDescription\": \"\",\n            \"DefaultChannelImportance\": \"high\",\n            \"DefaultChannelLightColor\": \"#FF2C37\",\n            \"NotificationChannelLockscreenVisibility\": \"secret\",\n            \"NotificationChannelIsSoundOn\": true,\n            \"NotificationChannelIsShowBadgeOn\": true,\n            \"NotificationChannelIsVibrationOn\": true\n        }\n        ...\n    },\n```\n\nNote: notification payload settings will always override the notification settings from `.unoproj`.\nNB! Once a channel is created, you CANNOT change its properties later.\n\n## Remarks\n\nThis module is an @EventEmitter, so the methods from @EventEmitter can be used to listen to events.\n\nYou need to add a reference to `Fuse.PushNotifications` in your project file to use this feature.\n\n## Android setup\nThis section covers how to set up Firebase Push Notifications to the point that you can send test messages to a Fuse App from the Firebase console.\n\n### Registering the Sender ID\n\n- Open the [Firebase Console](https://console.firebase.google.com)\n- Select your project or create one if you haven't already\n- Click the little cogwheel button at the top of the sidebar, and press \"Project settings\"\n- Navigate to the \"Cloud Messaging\" tab\n- Copy the \"Sender ID\" into your `.unoproj` like this:\n```json\n\t\t\"Android\": {\n\t\t\t\"GooglePlay\": {\n\t\t\t\t\"SenderID\": \"<Sender ID goes here>\"\n\t\t\t}\n\t\t}\n```\n### Registering the Android app\n\nTo enable Firebase Cloud Messaging, you need to register an Android app with your Firebase project.\nIf you haven't already registered an Android app, follow these steps:\n\n- From the settings page, click the button to add a new Android app to the project\n- A dialog will pop up, prompting you for a package name (the other fields are optional).\n\tBy default, this will be `com.apps.<yourappnameinlowercase>`.\n\tHowever, it is recommended to set your own:\n```json\n\t\t\"Android\": {\n\t\t\t\"Package\": \"com.mycompany.myapp\",\n\t\t}\n```\n- After adding the Android app, you will be prompted to download a `google-services.json` file. Download and copy it to the root of your project.\n- Add the following file to tell fuse to copy google-services.json to your android app folder:\n\nAndroid.uxl\n\n```xml\n<Extensions Backend=\"CPlusPlus\" Condition=\"Android\">\n    <CopyFile Condition=\"Android\" Name=\"google-services.json\" TargetName=\"app/google-services.json\" />\n</Extensions>\n```\n\n### Sending notifications\n\nAfter rebuilding your project with the new settings, you should be ready to send and receive push notifications.\n\n> **Note:** Fuse currently only supports `data` type messages. See [here for details on messages types](https://firebase.google.com/docs/cloud-messaging/concept-options#data_messages) & [this forum post](https://forums.fusetools.com/t/push-notificacions-with-google-firebase-notifications/2910/16) for more information on how we will fix this in future.\n> Sadly this means you currently can't use the Firebase Console to send test notifications (they will appear in the notification bar but will fail to reach JS).\n> See the example below for an example of how to send messages to a Fuse app.\n\nWhen your app starts, the `registrationSucceeded` event will be triggered and you will be given the `regID`\nThis, along with your FCM Server key, are the details that is needed to send that app a notification.\n\nYour server key can be found under the \"Cloud Messaging\" tab of the Project Settings page (where you obtained your Sender ID).\n\nHere some example Fuse code for sending your app a notification.\n```xml\n    <JavaScript>\n        var API_ACCESS_KEY = '----HARDCODED API KEY----';\n        var regID = '----HARDCODED REG ID FROM THE APP YOU ARE SENDING TO----';\n\n        module.exports.send = function() {\n            fetch('https://android.googleapis.com/gcm/send', {\n                method: 'post',\n                headers: {\n                    'Authorization': 'key=' + API_ACCESS_KEY,\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    registration_ids: [regID],\n                    data: {\n                        notification: {\n                            alert: {\n                                title: 'Well would ya look at that!',\n                                body: 'Hello from some other app'\n                            }\n                        },\n                        payload: 'anything you like'\n                    }\n                })\n            }).then(function(response) {\n                console.log(JSON.stringify(response));\n            }, function(error) {\n                console.log(error);\n            });\n        }\n    </JavaScript>\n```\nWhilst hardcoding the RegID is clearly not a good idea, it serves the purpose for this simple test.\n\n## iOS setup\nThis section covers how to set up a iOS Push Notifications to the point that you can send messages to a Fuse App.\n\n### Certifying your app for ACS\n\nTo do this you need an SSL certificate for your app.\n\n- Go to the [Apple Dev Center](https://developer.apple.com/account/overview.action)\n- Go to the Certificates Section for iOS apps\n- In the link bar on the left, under the `Identifiers` section click `App IDs`\n- Click the `+` icon in the top right to create a new App ID\n- Fill in the details, you cant use push notification with a `Wildcard App ID` so pick `Explicit App ID` and check in XCode for the app's `Bundle ID`\n- Under `App Services` enable Push notifications (and anything else you need)\n- Click `Continue` and confirm the certificate choice you made.\n\n### Syncing XCode\n\nYour app is now authenticated for Push notifications. Be sure to resync your profiles in XCode before re-building your app.\nTo do this:\n- Open XCode\n- In the menu-bar choose `XCode`->`Preferences`\n- In the Preferences window view the `Accounts` tab\n- In the `Accounts` tab click `View Details` for the relevant Apple ID\n- Click the small refresh button in the bottom left of the `View Details` window\n\n### Sending Push Notifications to iOS from OSX\n\nFor simple testing you may find that setting up a server is a bit of an overkill. To this end we recommend [NWPusher](https://github.com/noodlewerk/NWPusher). Download the binary [here](https://github.com/noodlewerk/NWPusher/releases/tag/0.6.3) and then follow the following sections from the README\n\n- `Getting started`\n- `Certificate`\n- Instead of reading the `Device Token` section simply add the example from above to your UX file\n- Finally, follow the `Push from OS X` Section\n\nDone, you should now be pushing notifications from OSX to iOS.",
              "attributes": {
                "scriptModule": "FuseJS/Push"
              }
            },
            "id": {
              "id": "fuse/pushnotifications/push",
              "parentId": "fuse/pushnotifications",
              "type": "JsModule",
              "modifiers": [
                "public",
                "sealed"
              ]
            },
            "uri": {
              "idUri": "fuse/pushnotifications/push",
              "href": "fuse/pushnotifications/push"
            },
            "titles": {
              "indexTitle": "Push",
              "fullyQualifiedIndexTitle": "Fuse.PushNotifications.Push"
            }
          }
        ]
      }
    ],
    "classes": [
      {
        "items": [
          {
            "id": {
              "id": "fuse/pushnotifications/pushnotify",
              "parentId": "fuse/pushnotifications",
              "type": "Class",
              "modifiers": [
                "public",
                "static"
              ]
            },
            "uri": {
              "idUri": "fuse/pushnotifications/pushnotify",
              "href": "fuse/pushnotifications/pushnotify"
            },
            "titles": {
              "indexTitle": "PushNotify",
              "fullyQualifiedIndexTitle": "Fuse.PushNotifications.PushNotify"
            }
          }
        ]
      }
    ]
  }
}